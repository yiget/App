<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.UserDao">
	<!-- 后台登录 -->	
	<select id="findCode" resultType="entity.BackendUser" parameterType="Map">
	    select *,(select valuename from data_dictionary where id=a.userType) userTypeName from backend_user a  where userCode=#{code}
			<if test="password != null">
				and userPassword = #{password}
			</if>
	</select>
	<!-- 前台登录 -->	
	<select id="findUser" resultType="entity.DevUser" parameterType="Map">
	    select * from dev_user where devCode=#{code}
			<if test="password != null">
				and devPassword = #{password}
			</if>
	</select>
	<!-- 查询所有App信息 -->
		<select id="queryApp" resultType="entity.AppInfo" parameterType="Map">
SELECT a.id,a.softwareName,a.apkName,a.softwareSize,(SELECT valueName FROM data_dictionary WHERE a.flatformId = valueId AND typeName = '所属平台') AS flatformName,
(SELECT categoryName FROM app_category WHERE a.categoryLevel1 = id) AS categoryLevel1Name,
(SELECT categoryName FROM app_category WHERE a.categoryLevel2 = id) AS categoryLevel2Name,
(SELECT categoryName FROM app_category WHERE a.categoryLevel3 = id) AS categoryLevel3Name,
(SELECT valueName FROM data_dictionary WHERE a. STATUS = valueId AND typeName = 'APP状态') AS statusName,a.downloads,
(SELECT versionNo FROM app_version WHERE a.versionId = id) AS versionNo FROM app_info a
		<where>
			<if test="softwareName != null and softwareName != ''">
				and softwareName like CONCAT ('%',#{softwareName},'%')
			</if>
		</where>
	LIMIT #{pageIndex},5
	</select>
	<!-- 查询App总页数 -->
	<select id="count" resultType="int" parameterType="Map">
	      select count(*) from app_info
		<where>
			<if test="softwareName != null and softwareName != ''">
				and softwareName like CONCAT ('%',#{softwareName},'%')
			</if>
		</where>
	</select>
	<!-- 查询所属平台 -->
	<select id="queryPt" resultType="entity.DataDictionary">
	    SELECT * FROM data_dictionary WHERE typeName = '所属平台'
	</select>
	<!-- 查询APP状态 -->
	<select id="queryZt" resultType="entity.DataDictionary">
	    SELECT * FROM data_dictionary WHERE typeName = 'APP状态'
	</select>
	
	<!-- 根据ID查询APP信息 -->
 	<select id="queryID" resultType="entity.AppInfo">
SELECT a.id,a.softwareName,a.apkName,a.supportROM,a.interfaceLanguage,a.softwareSize,(SELECT valueName FROM data_dictionary WHERE a.flatformId = valueId AND typeName = '所属平台') AS flatformName,
(SELECT categoryName FROM app_category WHERE a.categoryLevel1 = id) AS categoryLevel1Name,
(SELECT categoryName FROM app_category WHERE a.categoryLevel2 = id) AS categoryLevel2Name,
(SELECT categoryName FROM app_category WHERE a.categoryLevel3 = id) AS categoryLevel3Name,
(SELECT valueName FROM data_dictionary WHERE a. STATUS = valueId AND typeName = 'APP状态') AS statusName,a.downloads,a.appInfo,
(SELECT versionNo FROM app_version WHERE a.versionId = id) AS versionNo FROM app_info a where id = #{id}
	</select> 
	
	<select id="queryBb" resultType="entity.AppVersion">
select (select softwareName from app_info where a.id=versionId)as appName,a.versionNo,a.versionSize,(SELECT valueName FROM data_dictionary WHERE a.publishStatus = valueId AND typeName = '发布状态') as publishStatusName,
a.downloadLink,a.apkFileName,a.modifyDate from app_version a where appId=#{id}
	</select>
	<!-- 查询一级分类 -->
<!-- 	<select id="queryYi" resultType="entity.AppCategory">
	    SELECT categoryName FROM app_category  WHERE parentId is null
	</select> -->
	<!-- 查询二级分类 -->
<!-- 	<select id="queryEr" resultType="entity.AppCategory">
	    SELECT categoryName FROM app_category  WHERE parentId in
		(SELECT id FROM app_category  WHERE parentId is null)
	</select> -->
	<!-- 查询三级分类 -->
<!-- 	<select id="querySan" resultType="entity.AppCategory">
	    SELECT categoryName FROM app_category  WHERE parentId in
	    (SELECT id FROM app_category  WHERE parentId in
	    (SELECT id FROM app_category  WHERE parentId is null))
	</select> -->
		<select id="fenlei" resultType="entity.AppCategory" parameterType="int">
	select * from app_category WHERE parentid = #{id}
	</select>
</mapper>